<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DSRT â€” Full Filter Template (Upload Â· Categories Â· Download)</title>
  <style>
    :root{ --bg:#071022; --card:#0d1620; --muted:#9fb0bd; --accent:#06b6d4; }
    *{box-sizing:border-box}
    body{ margin:0; font-family:Inter,system-ui,Arial; background:linear-gradient(180deg,var(--bg),#02060a); color:#eaf2f8; padding:18px; }
    .wrap{ max-width:1080px; margin:0 auto; display:flex; flex-direction:column; gap:14px; }
    header{ display:flex; justify-content:space-between; align-items:center; gap:12px; }
    h1{ font-size:18px; margin:0; }
    .controls{ display:flex; gap:8px; align-items:center; }
    .btn{ background:rgba(255,255,255,0.03); color:var(--muted); border:1px solid rgba(255,255,255,0.03); padding:8px 12px; border-radius:10px; cursor:pointer; }
    .btn.primary{ background:var(--accent); color:#012; border:none; font-weight:700; }
    input[type=file]{ display:none; }.stage{ display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap; }
.preview{ flex:1 1 640px; min-width:260px; }
.frame{ border-radius:12px; overflow:hidden; background:#061018; min-height:420px; display:flex; align-items:center; justify-content:center; position:relative; }
.frame img{ width:100%; height:100%; object-fit:contain; transition:filter 260ms ease, transform 260ms ease; user-select:none; -webkit-user-drag:none; }

.sidebar{ width:380px; min-width:240px; display:flex; flex-direction:column; gap:12px; }
.card{ background:rgba(255,255,255,0.02); padding:12px; border-radius:12px; box-shadow:0 8px 24px rgba(0,0,0,0.6); }

/* categories tab */
.categories{ display:flex; gap:8px; flex-wrap:wrap; }
.cat-btn{ padding:8px 12px; border-radius:10px; cursor:pointer; background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.03); }
.cat-btn.active{ background:rgba(6,182,212,0.12); color:var(--accent); border-color:rgba(6,182,212,0.18); font-weight:700; }

/* filter strip */
.filters-track{ display:flex; gap:12px; overflow-x:auto; padding:12px; -webkit-overflow-scrolling:touch; }
.filter-chip{ flex:0 0 auto; width:110px; text-align:center; cursor:pointer; color:var(--muted); font-size:13px; }
.thumb{ width:100px; height:72px; border-radius:9px; overflow:hidden; background:#061018; display:flex; align-items:center; justify-content:center; border:2px solid transparent; }
.filter-chip.active .thumb{ border-color: rgba(6,182,212,0.18); box-shadow:0 6px 20px rgba(6,182,212,0.04); }
.filter-name{ margin-top:6px; display:block; }

.range{ width:100%; }

.download-grid{ display:flex; gap:8px; flex-wrap:wrap; }
.download-grid button{ flex:1 1 120px; }

footer{ text-align:center; color:var(--muted); font-size:13px; padding:8px 0; }

@media (max-width:980px){ .stage{ flex-direction:column-reverse; } .sidebar{ width:100%; } }

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>DSRT â€” Full Filter Template</h1>
      <div class="controls">
        <label class="btn card" id="uploadLabel">ðŸ“¤ Upload Foto
          <input id="fileInput" type="file" accept="image/*">
        </label>
        <button id="resetBtn" class="btn">Reset</button>
        <button id="downloadBtn" class="btn primary">Download</button>
      </div>
    </header><main class="stage">
  <section class="preview card">
    <div class="frame" id="frame">
      <img id="mainImage" src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1600&auto=format&fit=crop&s=0b2e3f6d9b3f2d4cb0cd5e6a2f3d5e9f" alt="preview">
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <div style="font-size:13px;color:var(--muted)">Filter: <strong id="currentName">Normal</strong></div>
      <div style="display:flex;gap:8px;align-items:center">
        <label style="font-size:13px;color:var(--muted)">Intensity</label>
        <input id="intensity" class="range" type="range" min="0" max="200" value="100" style="width:160px">
      </div>
    </div>

    <div class="card" style="margin-top:12px">
      <div class="filters-track" id="filtersTrack" aria-label="Daftar filter">
        <!-- chips akan di-render di sini -->
      </div>
    </div>
  </section>

  <aside class="sidebar">
    <div class="card">
      <div style="font-size:14px;color:var(--muted);margin-bottom:8px">Kategori</div>
      <div class="categories" id="categories">
        <!-- tombol kategori -->
      </div>
    </div>

    <div class="card">
      <div style="font-size:14px;color:var(--muted);margin-bottom:8px">Download</div>
      <div style="font-size:13px;color:var(--muted);margin-bottom:8px">Pilih resolusi untuk download hasil (filter diterapkan):</div>
      <div class="download-grid">
        <button class="btn" data-w="640">Small â€” 640px</button>
        <button class="btn" data-w="1280">Medium â€” 1280px</button>
        <button class="btn" data-w="1920">Large â€” 1920px</button>
        <button class="btn primary" data-w="orig">Original</button>
      </div>
    </div>

    <div class="card">
      <div style="font-size:14px;color:var(--muted);margin-bottom:8px">Aksi</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="applyBtn" class="btn">Apply & Download</button>
        <button id="revertBtn" class="btn">Revert</button>
      </div>
    </div>

  </aside>
</main>

<footer>Template lengkap â€” upload, kategori (tap), scroll filter, intensity, download multi-res.</footer>

  </div><script>
// ====== DATA: kategori + filter presets (banyak, tanpa duplikat) ======
const categoryDefs = [
  { key:'hue', label:'Hue', items: (function(){
      const arr=[]; for(let d=-180; d<=180; d+=30) arr.push({name:`Hue ${d}Â°`, css:`hue-rotate(${d}deg)`}); return arr; })() },

  { key:'sepia', label:'Sepia', items:[
      {name:'Classic Sepia', css:'sepia(1)'}, {name:'Warm Sepia', css:'sepia(0.65) saturate(1.05) brightness(1.02)'},
      {name:'Deep Sepia', css:'sepia(0.9) contrast(1.05)'}, {name:'Red Sepia', css:'sepia(0.6) hue-rotate(-10deg) saturate(1.1)'},
      {name:'Brown Fade', css:'sepia(0.45) brightness(0.98) contrast(0.95)' }
    ] },

  { key:'bmw', label:'BMW', items:[
      {name:'BMW Classic', css:'contrast(1.08) saturate(1.02) brightness(1.02) hue-rotate(-6deg)'},
      {name:'BMW Soft', css:'contrast(0.98) saturate(0.95) brightness(1.04)'},
      {name:'BMW Deep', css:'contrast(1.18) saturate(1.25) brightness(0.96) hue-rotate(200deg)'},
      {name:'BMW Neon', css:'saturate(1.45) contrast(1.15) hue-rotate(220deg) brightness(1.03)'},
      {name:'BMW Vintage', css:'contrast(1.05) sepia(0.12) saturate(0.92)'}
    ] },

  { key:'bw', label:'Black & White', items:[
      {name:'Monochrome', css:'grayscale(1)'}, {name:'High Contrast B/W', css:'grayscale(1) contrast(1.2)'},
      {name:'Soft B/W', css:'grayscale(1) contrast(0.95) brightness(1.03)'}, {name:'Film Noir', css:'grayscale(1) contrast(1.4) brightness(0.9)'},
      {name:'Infrared B/W', css:'grayscale(1) contrast(1.05) hue-rotate(45deg)'}
    ] },

  { key:'vintage', label:'Vintage', items:[
      {name:'Retro Warm', css:'sepia(0.28) saturate(0.9) contrast(0.98)'},
      {name:'70s Film', css:'contrast(0.98) saturate(0.9) hue-rotate(-10deg)'},
      {name:'80s Cool', css:'saturate(0.95) hue-rotate(10deg) contrast(0.96)'},
      {name:'Faded Print', css:'brightness(0.98) contrast(0.92) saturate(0.85)'},
      {name:'Polaroid', css:'brightness(1.02) contrast(0.98) sepia(0.08)'}
    ] },

  { key:'cinema', label:'Cinematic', items:[
      {name:'Teal & Orange', css:'contrast(1.08) saturate(1.05) hue-rotate(-10deg)'},
      {name:'Dark Cinema', css:'contrast(1.25) brightness(0.92) saturate(0.9)'},
      {name:'Hollywood Warm', css:'sepia(0.12) contrast(1.05) saturate(1.06)'},
      {name:'Cool Drama', css:'contrast(1.12) hue-rotate(170deg) saturate(0.95)'},
      {name:'Sci-Fi Tone', css:'hue-rotate(200deg) saturate(1.12) contrast(1.06)'}
    ] },

  { key:'matte', label:'Matte / Soft', items:[
      {name:'Matte Warm', css:'brightness(1.02) contrast(0.92) saturate(0.95)'},
      {name:'Matte Cool', css:'brightness(1.01) contrast(0.92) hue-rotate(180deg) saturate(0.9)'},
      {name:'Matte Pastel', css:'saturate(0.8) brightness(1.03) contrast(0.9)'},
      {name:'Soft Glow', css:'brightness(1.06) blur(1px) saturate(1.02)'},
      {name:'Soft Mist', css:'brightness(1.02) saturate(0.95) blur(0.8px)'}
    ] },

  { key:'vibrance', label:'Vibrance & Pop', items:[
      {name:'Vivid Colors', css:'saturate(1.35) contrast(1.08)'},
      {name:'Boosted Blues', css:'saturate(1.15) hue-rotate(200deg) contrast(1.03)'},
      {name:'Boosted Reds', css:'saturate(1.2) hue-rotate(-10deg) contrast(1.05)'},
      {name:'Tropical Pop', css:'saturate(1.4) brightness(1.03)'},
      {name:'Festival Glow', css:'saturate(1.3) brightness(1.06) contrast(1.04)'}
    ] },

  { key:'portrait', label:'Portrait / Skin', items:[
      {name:'Smooth Warm', css:'brightness(1.03) saturate(1.05) contrast(0.98)'},
      {name:'Smooth Cool', css:'brightness(1.02) saturate(0.95) hue-rotate(180deg)'},
      {name:'Rosy Skin', css:'saturate(1.06) contrast(0.98) hue-rotate(-6deg)'},
      {name:'Golden Skin', css:'brightness(1.04) sepia(0.08) saturate(1.05)'},
      {name:'Soft Tan', css:'sepia(0.12) saturate(1.02) brightness(1.01)'}
    ] },

  { key:'anime', label:'Anime / Cartoon', items:[
      {name:'Toon Smooth', css:'contrast(1.12) saturate(1.1)'}, {name:'Toon Bold', css:'contrast(1.28) saturate(1.25)'},
      {name:'Manga Ink', css:'grayscale(1) contrast(1.5) brightness(0.98)'}, {name:'Pixar Style', css:'saturate(1.25) contrast(1.06)'}
    ] },

  { key:'hdr', label:'HDR / Detail', items:[
      {name:'HDR Strong', css:'contrast(1.35) saturate(1.12)'}, {name:'HDR Balanced', css:'contrast(1.12) saturate(1.06)'},
      {name:'Clarity Boost', css:'contrast(1.15) brightness(1.02)'}
    ] },

  { key:'duotone', label:'Duotone', items:[
      {name:'Blue-Pink', css:'sepia(0.1) saturate(1.2) hue-rotate(200deg)'},
      {name:'Purple-Gold', css:'sepia(0.08) saturate(1.15) hue-rotate(260deg)'},
      {name:'Red-Teal', css:'saturate(1.05) hue-rotate(-10deg)'}
    ] },

  { key:'neon', label:'Neon / Glow', items:[
      {name:'Neon Pink', css:'saturate(1.6) hue-rotate(-30deg) contrast(1.05)'},
      {name:'Neon Blue', css:'saturate(1.6) hue-rotate(190deg) contrast(1.05)'},
      {name:'Neon Multi', css:'saturate(1.5) contrast(1.08)'}
    ] },

  { key:'glitch', label:'Glitch / VHS', items:[
      {name:'RGB Shift', css:'contrast(1.05) saturate(1.05)'} ,
      {name:'Static', css:'brightness(0.98) contrast(1.02)'} ,
      {name:'VHS Grain', css:'contrast(0.98) saturate(0.95)'}
    ] },

  { key:'sun', label:'Sunlight / Lens', items:[
      {name:'Golden Sun', css:'brightness(1.06) saturate(1.08) hue-rotate(-6deg)'},
      {name:'Light Leak', css:'brightness(1.08) saturate(1.1)'} ,
      {name:'Soft Glow', css:'brightness(1.06) blur(0.8px)'}
    ] },

  { key:'night', label:'Night / Dark', items:[
      {name:'Midnight Blue', css:'brightness(0.9) contrast(1.08) hue-rotate(200deg)'},
      {name:'Noir Fade', css:'contrast(1.2) brightness(0.88) grayscale(0.1)'},
      {name:'Cyber Dark', css:'saturate(1.05) contrast(1.18) hue-rotate(220deg)'}
    ] },

  { key:'overlay', label:'Overlay / Texture', items:[
      {name:'Dust Overlay', css:'contrast(0.98) brightness(0.99)'}, {name:'Scratches', css:'contrast(0.96) brightness(0.98)'},
      {name:'Paper Grain', css:'contrast(0.98) saturate(0.95)'}
    ] },

  { key:'season', label:'Seasonal', items:[
      {name:'Autumn Warm', css:'saturate(1.08) hue-rotate(-6deg) brightness(1.02)'},
      {name:'Winter Cold', css:'saturate(0.92) hue-rotate(180deg) contrast(0.98)'},
      {name:'Spring Fresh', css:'saturate(1.12) brightness(1.03)'},
      {name:'Summer Vivid', css:'saturate(1.2) brightness(1.04)'}
    ] },

  { key:'fantasy', label:'Fantasy', items:[
      {name:'Galaxy', css:'saturate(1.25) hue-rotate(220deg) contrast(1.04)'},
      {name:'Aurora', css:'saturate(1.18) hue-rotate(200deg)'} ,
      {name:'Magic Glow', css:'brightness(1.06) saturate(1.15) blur(0.6px)'}
    ] }
];

// ======= Utilities & state ======
const mainImage = document.getElementById('mainImage');
const filtersTrack = document.getElementById('filtersTrack');
const categoriesEl = document.getElementById('categories');
const currentName = document.getElementById('currentName');
const intensity = document.getElementById('intensity');
let activeCategoryKey = null;
let activeList = [];
let activeIndex = 0;
let originalSrc = mainImage.src;

function uniqueByCss(items){
  const seen = new Set();
  const out = [];
  for(const it of items){
    const key = (it.css||'none').trim();
    if(!seen.has(key)) { seen.add(key); out.push(it); }
  }
  return out;
}

// render category buttons
function renderCategories(){
  categoriesEl.innerHTML = '';
  categoryDefs.forEach(cat => {
    const b = document.createElement('button'); b.className='cat-btn'; b.textContent=cat.label; b.dataset.key=cat.key;
    b.addEventListener('click', ()=> showCategory(cat.key));
    categoriesEl.appendChild(b);
  });
}
renderCategories();

function showCategory(key){
  const cat = categoryDefs.find(c=>c.key===key); if(!cat) return;
  // visual
  document.querySelectorAll('.cat-btn').forEach(b=> b.classList.toggle('active', b.dataset.key===key));
  // compile items and dedupe
  let items = Array.isArray(cat.items) ? cat.items.slice() : [];
  items = uniqueByCss(items);
  activeCategoryKey = key; activeList = items; activeIndex = 0;
  renderFilterChips(items);
  if(items.length) selectFilter(items,0);
}

function renderFilterChips(list){
  filtersTrack.innerHTML='';
  list.forEach((f,i)=>{
    const chip = document.createElement('div'); chip.className='filter-chip'; chip.dataset.index=i;
    const thumb = document.createElement('div'); thumb.className='thumb';
    const timg = document.createElement('img'); timg.src = mainImage.src; timg.alt = f.name; timg.style.width='100%'; timg.style.height='100%'; timg.style.objectFit='cover';
    timg.style.filter = f.css||'none'; timg.style.pointerEvents='none';
    thumb.appendChild(timg);
    const name = document.createElement('div'); name.className='filter-name'; name.textContent=f.name;
    chip.appendChild(thumb); chip.appendChild(name);
    chip.addEventListener('click', ()=> selectFilter(list,i,chip));
    filtersTrack.appendChild(chip);
  });
}

function selectFilter(list, idx, chipEl){
  const f = list[idx]; if(!f) return;
  activeIndex = idx; activeList = list;
  // scale numeric values by intensity, except deg/%
  const scale = parseInt(intensity.value,10)/100;
  let css = (f.css||'none');
  if(css==='none') mainImage.style.filter='none'; else {
    css = css.replace(/([a-z-]+)î€\s*([0-9.]+)(deg|%)?\s*î€/ig, (m,fn,val,suffix)=>{
      if(suffix==='deg' || suffix==='%') return `${fn}(${val}${suffix||''})`;
      const scaled = parseFloat(val)*scale; return `${fn}(${scaled})`;
    });
    mainImage.style.filter = css;
  }
  currentName.textContent = f.name;
  document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
  if(!chipEl) chipEl = document.querySelector(`.filter-chip[data-index="${idx}"]`);
  if(chipEl) chipEl.classList.add('active');
}

intensity.addEventListener('input', ()=>{
  if(!activeList.length) return; selectFilter(activeList, activeIndex);
});

// Upload handling
const fileInput = document.getElementById('fileInput');
fileInput.addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const url = URL.createObjectURL(file); originalSrc = url; mainImage.src = url;
  // re-render thumbs
  setTimeout(()=>{ if(activeCategoryKey) showCategory(activeCategoryKey); else renderDefaultThumbs(); },50);
});

// Reset / revert
document.getElementById('resetBtn').addEventListener('click', ()=>{
  mainImage.src = originalSrc; mainImage.style.filter='none'; intensity.value=100; currentName.textContent='Normal'; document.querySelectorAll('.filter-chip').forEach(c=>c.classList.remove('active'));
});

document.getElementById('revertBtn').addEventListener('click', ()=> document.getElementById('resetBtn').click());

// Download: support multi-res using canvas and ctx.filter
function downloadWithWidth(widthTag){
  if(!mainImage.src) return alert('Upload gambar dulu!');
  const img = mainImage;
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  let targetW, targetH;
  if(widthTag==='orig'){ targetW = img.naturalWidth || img.width; targetH = img.naturalHeight || img.height; }
  else { targetW = parseInt(widthTag,10); const ratio = (img.naturalWidth||img.width) / (img.naturalHeight||img.height); targetH = Math.round(targetW / ratio); }
  canvas.width = targetW; canvas.height = targetH;
  // apply filter if supported
  const applied = img.style.filter || 'none';
  if(ctx.filter !== undefined){
    ctx.filter = applied;
    // draw image scaled to canvas
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    canvas.toBlob(blob=>{
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `dsrt-${activeCategoryKey||'filtered'}-${targetW}x${targetH}.png`; a.click();
    }, 'image/png');
  } else {
    // fallback: draw without filter and warn
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    alert('Browser tidak mendukung ctx.filter. Hasil download tidak akan memasukkan efek CSS tertentu. Gunakan Chrome/Edge terbaru untuk hasil terbaik.');
    canvas.toBlob(blob=>{ const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`dsrt-${targetW}x${targetH}.png`; a.click(); }, 'image/png');
  }
}

// wire download buttons
document.querySelectorAll('.download-grid button').forEach(b=>{
  b.addEventListener('click', ()=> downloadWithWidth(b.dataset.w));
});

document.getElementById('downloadBtn').addEventListener('click', ()=>{
  // default: download medium
  downloadWithWidth('1280');
});

document.getElementById('applyBtn').addEventListener('click', ()=> downloadWithWidth('orig'));

// initial render: show first category and thumbs
function renderDefaultThumbs(){
  // show first category if available
  if(categoryDefs && categoryDefs.length) showCategory(categoryDefs[0].key);
}
renderDefaultThumbs();

// update thumbs when main image loads (so they use uploaded image)
mainImage.addEventListener('load', ()=>{
  document.querySelectorAll('.filters-track img').forEach(img=> img.src = mainImage.src );
});

</script></body>
</html>
