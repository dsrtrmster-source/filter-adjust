<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Instagram-style Filters â€” DSRT</title>
<style>
  :root{
    --bg:#0f1720;
    --card:#111827;
    --muted:#9ca3af;
    --accent:#06b6d4;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,var(--bg), #071022 140%);
    color:#e6eef6;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:24px;
  }

  .app {
    max-width:980px;
    margin:0 auto;
    display:flex;
    gap:24px;
    flex-direction:column;
  }

  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }
  header h1{
    margin:0;
    font-size:18px;
    letter-spacing:0.2px;
  }
  .controls { display:flex; gap:8px; align-items:center; }

  .card{
    background:rgba(255,255,255,0.03);
    border-radius:12px;
    padding:16px;
    box-shadow:0 6px 16px rgba(2,6,23,0.6);
  }

  .stage{
    display:flex;
    gap:20px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .preview {
    flex:1 1 480px;
    min-width:260px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .frame{
    border-radius:12px;
    overflow:hidden;
    background:#0a0f14;
    display:flex;
    justify-content:center;
    align-items:center;
    min-height:360px;
    max-height:640px;
    position:relative;
  }
  .frame img{
    width:100%;
    height:100%;
    object-fit:contain;
    display:block;
    transition:filter 260ms ease, transform 260ms ease;
    user-select:none;
    -webkit-user-drag:none;
  }

  .right {
    width:320px;
    min-width:240px;
    display:flex;
    flex-direction:column;
    gap:12px;
  }

  .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .btn {
    background:linear-gradient(90deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    color:var(--muted);
    border:1px solid rgba(255,255,255,0.03);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    font-weight:600;
    font-size:14px;
  }
  .btn.primary { color:#042f33; background:var(--accent); border:none; }
  input[type="file"] { display:none; }
  label.upload {
    display:inline-flex; align-items:center; gap:8px; cursor:pointer;
  }

  /* filter strip */
  .filters {
    margin-top:12px;
  }
  .filters-track {
    display:flex;
    gap:12px;
    overflow-x:auto;
    padding:8px 6px;
    scrollbar-width:thin;
    -webkit-overflow-scrolling:touch;
  }
  .filters-track::-webkit-scrollbar{height:10px}
  .filters-track::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.06);border-radius:8px}

  .filter-chip{
    flex:0 0 auto;
    width:96px;
    text-align:center;
    cursor:pointer;
    font-size:13px;
    color:var(--muted);
  }
  .thumb{
    border-radius:10px;
    overflow:hidden;
    height:72px;
    background:#0b1220;
    display:flex;
    align-items:center;
    justify-content:center;
    border:2px solid transparent;
  }
  .filter-chip.active .thumb{ border-color: rgba(6,182,212,0.18); box-shadow:0 6px 20px rgba(6,182,212,0.06) }
  .filter-name{ margin-top:6px; display:block; }

  .range{
    width:100%;
  }

  footer{ text-align:center; color:var(--muted); font-size:13px; padding:8px 0; }

  @media (max-width:880px){
    .stage{ flex-direction:column-reverse; }
    .right{ width:100%; }
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <h1>DSRT â€” Filter Preview</h1>
      <div class="controls">
        <label class="upload card btn" title="Upload gambar">
          <input id="inputFile" type="file" accept="image/*">
          ðŸ“¤ Upload Foto
        </label>
        <button id="resetBtn" class="btn">Reset</button>
        <button id="downloadBtn" class="btn primary">Download</button>
      </div>
    </header>

    <main class="card stage">
      <section class="preview">
        <div class="frame" id="frame">
          <!-- default image -->
          <img id="mainImage" src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?q=80&w=1600&auto=format&fit=crop&ixlib=rb-4.0.3&s=0b2e3f6d9b3f2d4cb0cd5e6a2f3d5e9f" alt="preview">
        </div>

        <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
          <div style="font-size:13px;color:var(--muted)">Filter: <strong id="currentName">Normal</strong></div>
          <div style="display:flex;gap:8px;align-items:center">
            <label style="font-size:13px;color:var(--muted)">Intensity</label>
            <input id="intensity" class="range" type="range" min="0" max="100" value="100" style="width:160px">
          </div>
        </div>

        <div class="filters card">
          <div class="filters-track" id="filtersTrack" aria-label="Daftar filter">
            <!-- chips dynamically injected -->
          </div>
        </div>
      </section>

      <aside class="right">
        <div class="card" style="padding:12px">
          <div style="font-size:14px;color:var(--muted);margin-bottom:8px">Preview kecil (tap untuk pilih)</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <div style="height:120px;border-radius:8px;background:#061018;display:flex;align-items:center;justify-content:center;color:var(--muted)">Tips: Upload foto resolusi tinggi untuk hasil terbaik</div>
            <div style="height:120px;border-radius:8px;background:#061018;display:flex;align-items:center;justify-content:center;color:var(--muted)">Scroll filter ke kiri/kanan</div>
          </div>
        </div>

        <div class="card" style="padding:12px">
          <div style="font-size:14px;color:var(--muted);margin-bottom:8px">Actions</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="applyBtn" class="btn">Apply / Save Effect</button>
            <button id="revertBtn" class="btn">Revert to Original</button>
          </div>
        </div>

      </aside>
    </main>

    <footer>Template ringan â€” siap deploy ke GitHub & Vercel</footer>
  </div>

<script>
/*
  Filter list:
  - name: display name
  - css: CSS filter string for 100% intensity
  - NOTE: intensity slider scales values where applicable
*/
const filters = [
  {name:'Normal', css:'none'},
  {name:'Grayscale', css:'grayscale(1)'},
  {name:'Sepia', css:'sepia(1)'},
  {name:'Vintage', css:'sepia(0.35) contrast(0.95) saturate(0.8)'},
  {name:'Bright', css:'brightness(1.15) saturate(1.05)'},
  {name:'Contrast', css:'contrast(1.25)'},
  {name:'Invert', css:'invert(1)'},
  {name:'Cold', css:'sepia(0.05) saturate(1.2) hue-rotate(190deg) contrast(1.02)'},
  {name:'Warm', css:'sepia(0.18) saturate(1.2) hue-rotate(-10deg) contrast(1.02)'},
  {name:'Soft', css:'blur(1px) brightness(1.02)'},
  {name:'Mono + High', css:'grayscale(1) contrast(1.1)'},
  {name:'Drama', css:'contrast(1.2) saturate(0.85)'},
  {name:'Fade', css:'brightness(0.96) contrast(0.92) saturate(0.9)'},
  {name:'Lomo', css:'contrast(1.35) saturate(1.3) hue-rotate(-8deg)'},
];

const track = document.getElementById('filtersTrack');
const mainImage = document.getElementById('mainImage');
const currentName = document.getElementById('currentName');
const intensity = document.getElementById('intensity');

let activeIndex = 0;
let originalSrc = mainImage.src;

// helper: build chip element
function makeChip(filter, idx){
  const chip = document.createElement('div');
  chip.className = 'filter-chip' + (idx===0? ' active' : '');
  chip.dataset.index = idx;

  const thumb = document.createElement('div');
  thumb.className = 'thumb';
  // use same image as background for thumbnails to preview effect
  thumb.style.backgroundImage = `url('${mainImage.src}')`;
  thumb.style.backgroundSize = 'cover';
  thumb.style.backgroundPosition = 'center';

  // to preview filter on thumb, we create an <img> inside and apply css filter
  const img = document.createElement('img');
  img.src = mainImage.src;
  img.alt = filter.name;
  img.style.width = '100%';
  img.style.height = '100%';
  img.style.objectFit = 'cover';
  img.style.display = 'block';
  img.style.filter = filter.css === 'none' ? 'none' : filter.css;
  img.style.transform = 'scale(1.05)';
  img.style.pointerEvents = 'none';

  // clear background (the img covers)
  thumb.style.backgroundImage = 'none';
  thumb.appendChild(img);

  const name = document.createElement('span');
  name.className = 'filter-name';
  name.textContent = filter.name;

  chip.appendChild(thumb);
  chip.appendChild(name);

  chip.addEventListener('click', () => selectFilter(idx));
  return chip;
}

// render chips
function renderFilters(){
  track.innerHTML = '';
  filters.forEach((f,i) => {
    track.appendChild(makeChip(f,i));
  });
}
renderFilters();

function applyFilterByIndex(idx, intensityPercent = 100){
  const f = filters[idx];
  if(!f) return;
  currentName.textContent = f.name;
  activeIndex = idx;
  // simple intensity scaling approach:
  // if css uses functions like grayscale(1), sepia(1), etc, scale the numeric values
  // fallback: if css === 'none' -> none
  if(f.css === 'none'){
    mainImage.style.filter = 'none';
  } else {
    // replace numeric occurrences in css string by scaled value
    // e.g., "sepia(1) contrast(0.95)" -> scale each number by intensityPercent/100 for simple filters
    const scaled = f.css.replace(/([a-z-]+)\(\s*([0-9.]+)(deg|%)?\s*\)/ig, (m,fn,val,suffix) => {
      // when suffix is deg or % keep as-is (do not scale)
      if(suffix === 'deg' || suffix === '%') return `${fn}(${val}${suffix})`;
      const scale = parseFloat(val) * (intensityPercent/100);
      return `${fn}(${scale})`;
    });
    mainImage.style.filter = scaled;
  }

  // mark active chip
  track.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  const activeChip = track.querySelector(`.filter-chip[data-index="${idx}"]`);
  if(activeChip) activeChip.classList.add('active');
}

// when intensity changes
intensity.addEventListener('input', () => {
  applyFilterByIndex(activeIndex, parseInt(intensity.value,10));
});

// select filter
function selectFilter(idx){
  applyFilterByIndex(idx, parseInt(intensity.value,10));
}

// Upload new image
const inputFile = document.getElementById('inputFile');
inputFile.addEventListener('change', e => {
  const file = e.target.files[0];
  if(!file) return;
  const url = URL.createObjectURL(file);
  originalSrc = url;
  mainImage.src = url;
  // re-render thumbnails with new source
  setTimeout(()=> renderFilters(), 20);
});

// Reset
document.getElementById('resetBtn').addEventListener('click', ()=>{
  mainImage.src = originalSrc;
  intensity.value = 100;
  applyFilterByIndex(0,100);
});

// download (rendered image with filter using canvas)
document.getElementById('downloadBtn').addEventListener('click', async ()=>{
  // draw applied filter via CSS to canvas by using context.filter (limited support) or drawImage and apply offline CSS
  // We'll use Offscreen/Canvas with context.filter where supported.
  const img = mainImage;
  const canvas = document.createElement('canvas');
  canvas.width = img.naturalWidth || img.width;
  canvas.height = img.naturalHeight || img.height;
  const ctx = canvas.getContext('2d');

  // use ctx.filter if available
  const appliedFilter = img.style.filter || 'none';
  if(ctx.filter !== undefined){
    ctx.filter = appliedFilter;
    // draw centered and scaled to full canvas
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
    canvas.toBlob(blob => {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = `dsrt-filtered-${Date.now()}.png`;
      a.click();
    }, 'image/png');
  } else {
    alert('Fungsi download tidak didukung di browser ini. Coba di Chrome/Edge terbaru.');
  }
});

// apply / save (for UI, same as download)
document.getElementById('applyBtn').addEventListener('click', ()=>{
  document.getElementById('downloadBtn').click();
});

// revert
document.getElementById('revertBtn').addEventListener('click', ()=>{
  mainImage.src = originalSrc;
  intensity.value = 100;
  applyFilterByIndex(0,100);
});

// init default
applyFilterByIndex(0,100);

// update thumbnail images when main image loads (so thumbs show same source)
mainImage.addEventListener('load', () => {
  // update any <img> inside .thumb to use mainImage.src
  document.querySelectorAll('.filters-track img').forEach(img => {
    img.src = mainImage.src;
  });
});
</script>
</body>
  </html>
